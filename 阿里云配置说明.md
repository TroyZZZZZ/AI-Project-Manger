# 阿里云服务配置说明

本文档将指导您如何配置阿里云服务以使项目正常运行。

## 🔧 配置步骤

### 1. 阿里云账号准备

1. 注册阿里云账号：https://www.aliyun.com/
2. 完成实名认证
3. 开通所需服务（RDS、OSS等）

### 2. 获取访问密钥

1. 登录阿里云控制台
2. 点击右上角头像 → 访问控制
3. 创建RAM用户或使用主账号AccessKey
4. 记录 `AccessKey ID` 和 `AccessKey Secret`

### 3. 配置RDS MySQL数据库

#### 3.1 创建RDS实例
1. 进入RDS控制台：https://rdsnext.console.aliyun.com/
2. 创建MySQL实例（推荐8.0版本）
3. 配置实例规格（最低1核1GB）
4. 设置数据库名称：`project_management`
5. 设置管理员账号和密码

#### 3.2 配置网络和安全
1. 设置白名单，添加您的IP地址
2. 如果使用公网连接，开启公网地址
3. 记录内网/公网连接地址和端口

#### 3.3 初始化数据库
1. 使用MySQL客户端连接数据库
2. 执行项目根目录下的 `init.sql` 文件
```bash
mysql -h your_rds_host -P 3306 -u root -p project_management < init.sql
```

### 4. 配置OSS对象存储

#### 4.1 创建OSS Bucket
1. 进入OSS控制台：https://oss.console.aliyun.com/
2. 创建Bucket
   - Bucket名称：自定义（如：project-files-bucket）
   - 地域：选择与RDS相同地域
   - 存储类型：标准存储
   - 读写权限：私有
3. 记录Bucket名称和Endpoint地址

#### 4.2 配置跨域规则（CORS）
1. 进入Bucket管理页面
2. 权限管理 → 跨域设置
3. 添加规则：
   - 来源：`*`
   - 允许Methods：`GET, POST, PUT, DELETE, HEAD`
   - 允许Headers：`*`
   - 暴露Headers：`ETag, x-oss-request-id`

### 5. 更新环境变量

编辑项目根目录下的 `.env` 文件，替换以下占位符：

```env
# 阿里云基础配置
VITE_ALIYUN_ACCESS_KEY_ID=你的AccessKey_ID
VITE_ALIYUN_ACCESS_KEY_SECRET=你的AccessKey_Secret
VITE_ALIYUN_REGION=cn-hangzhou  # 你选择的地域

# 阿里云RDS数据库配置
VITE_ALIYUN_RDS_HOST=你的RDS连接地址
VITE_ALIYUN_RDS_PORT=3306
VITE_ALIYUN_RDS_DATABASE=project_management
VITE_ALIYUN_RDS_USERNAME=root  # 你设置的数据库用户名
VITE_ALIYUN_RDS_PASSWORD=你的数据库密码

# 后端数据库配置（不带VITE_前缀）
DB_HOST=你的RDS连接地址
DB_PORT=3306
DB_NAME=project_management
DB_USER=root  # 你设置的数据库用户名
DB_PASSWORD=你的数据库密码

# 阿里云OSS对象存储配置
VITE_ALIYUN_OSS_BUCKET=你的Bucket名称
VITE_ALIYUN_OSS_ENDPOINT=你的OSS_Endpoint

# 后端OSS配置（不带VITE_前缀）
ALIYUN_ACCESS_KEY_ID=你的AccessKey_ID
ALIYUN_ACCESS_KEY_SECRET=你的AccessKey_Secret
ALIYUN_OSS_REGION=cn-hangzhou  # 你选择的地域
ALIYUN_OSS_BUCKET=你的Bucket名称
ALIYUN_OSS_ENDPOINT=你的OSS_Endpoint

# JWT配置
JWT_SECRET=你的JWT密钥（建议使用复杂字符串）
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
```

## 🧪 测试配置

### 1. 测试数据库连接
```bash
npm run test:db
```

### 2. 启动后端服务
```bash
npm run dev:api
```

### 3. 启动前端服务
```bash
npm run dev
```

### 4. 同时启动前后端
```bash
npm run dev:full
```

## 🔍 常见问题

### 数据库连接失败
1. **ENOTFOUND错误**：检查RDS连接地址是否正确
2. **ER_ACCESS_DENIED_ERROR**：检查用户名密码是否正确
3. **ECONNREFUSED**：检查端口号和白名单设置
4. **ER_BAD_DB_ERROR**：检查数据库名称是否正确

### OSS上传失败
1. 检查AccessKey权限
2. 检查Bucket名称和地域
3. 检查CORS配置
4. 检查网络连接

### JWT认证问题
1. 确保JWT_SECRET足够复杂
2. 检查token过期时间设置
3. 确认前后端使用相同的密钥

## 💰 费用说明

### RDS费用
- 最小规格：约 ¥100-200/月
- 按量付费：约 ¥0.5-1/小时

### OSS费用
- 存储费用：约 ¥0.12/GB/月
- 流量费用：约 ¥0.5/GB

### 建议
- 开发测试阶段使用按量付费
- 生产环境考虑包年包月优惠
- 定期清理不需要的数据和文件

## 📞 技术支持

如果遇到配置问题，可以：
1. 查看阿里云官方文档
2. 联系阿里云技术支持
3. 在项目Issues中提问

---

**注意**：请妥善保管您的AccessKey等敏感信息，不要提交到代码仓库中！